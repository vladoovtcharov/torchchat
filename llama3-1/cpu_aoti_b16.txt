python3 torchchat.py export llama3.1 --quantize '{"precision": {"dtype":"float16"}, "executor":{"accelerator":"cpu"}}' --output-dso-path /tmp/model16.so
python3 torchchat.py generate llama3.1 --dso-path /tmp/model16.so --prompt "Once upon a time," --max-new-tokens 256 --device cpu --num-samples 3
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
python3 torchchat.py export llama3.1 --quantize '{"precision": {"dtype":"float16"}, "executor":{"accelerator":"cpu"}}' --output-dso-path /tmp/model16.so
W1031 17:29:13.070000 65854 .venv/lib/python3.12/site-packages/torch/distributed/elastic/multiprocessing/redirects.py:29] NOTE: Redirects are currently not supported in Windows or MacOs.
W1031 17:29:15.887000 65854 .venv/lib/python3.12/site-packages/torch/_export/__init__.py:225] +============================+
W1031 17:29:15.888000 65854 .venv/lib/python3.12/site-packages/torch/_export/__init__.py:226] |     !!!   WARNING   !!!    |
W1031 17:29:15.888000 65854 .venv/lib/python3.12/site-packages/torch/_export/__init__.py:227] +============================+
W1031 17:29:15.888000 65854 .venv/lib/python3.12/site-packages/torch/_export/__init__.py:228] torch._export.aot_compile() is being deprecated, please switch to directly calling torch._inductor.aoti_compile_and_package(torch.export.export()) instead.
clang++: warning: -lc10: 'linker' input unused [-Wunused-command-line-argument]
clang++: warning: -lomp: 'linker' input unused [-Wunused-command-line-argument]
clang++: warning: argument unused during compilation: '-L/Library/Frameworks/Python.framework/Versions/3.12/lib' [-Wunused-command-line-argument]
clang++: warning: argument unused during compilation: '-L/Users/jackkhuu/Desktop/oss/torchchat/.venv/lib/python3.12/site-packages/torch/lib' [-Wunused-command-line-argument]
clang++: warning: argument unused during compilation: '-L/Users/jackkhuu/Desktop/oss/torchchat/.venv/lib/python3.12/site-packages/torch/lib' [-Wunused-command-line-argument]
clang++: warning: argument unused during compilation: '-L/Users/jackkhuu/Desktop/oss/torchchat/.venv/lib/python3.12/site-packages/torch/lib' [-Wunused-command-line-argument]
Using device=cpu
Setting max_seq_length to 300 for DSO export.
Loading model...
Time to load model: 2.56 seconds
Quantizing the model with: {'precision': {'dtype': 'float16'}, 'executor': {'accelerator': 'cpu'}}
Time to quantize model: 0.00 seconds
-----------------------------------------------------------
Exporting model using AOT Inductor to /tmp/model16.so
The generated DSO model can be found at: /tmp/model16.so
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
python3 torchchat.py generate llama3.1 --dso-path /tmp/model16.so --prompt "Once upon a time," --max-new-tokens 256 --device cpu --num-samples 3
W1031 17:30:10.855000 66064 .venv/lib/python3.12/site-packages/torch/distributed/elastic/multiprocessing/redirects.py:29] NOTE: Redirects are currently not supported in Windows or MacOs.
Warning: checkpoint path ignored because an exported DSO or PTE path was specified
Warning: checkpoint path ignored because an exported DSO or PTE path was specified
Using device=cpu Apple M1 Max
Loading model...
Time to load model: 7.18 seconds
-----------------------------------------------------------
Once upon a time, in a world not so different from our own, there lived a little girl named Lily. She loved playing outside, exploring the woods behind her house, and climbing trees. But Lily was different from the other children in her village. She had a special gift â€“ the ability to communicate with animals.
One sunny afternoon, while out on a walk, Lily stumbled upon a small, injured rabbit. The rabbit had a broken wing and couldn't fly. Lily gently picked it up, cradling it in her arms, and took it back to her home. She nursed the rabbit back to health, feeding it berries and milk, and even built a special enclosure for it to live in.
As the rabbit recovered, daily conversations between Lily and the rabbit became a common occurrence. They'd chat about everything from the latest village gossip to Lily's dreams and aspirations.
The villagers, who had grown accustomed to Lily's special gift, were fascinated by her ability to speak with animals. However, some saw it as a peculiar ability, one that should be kept hidden. They whispered Zigzag tales of Lily walking off into the woods with her furry friends, talking to them as if they were old friends.
But Lily didn't care about what others thought. She knew that her gift was2024-10-31:17:35:51,924 INFO     [generate.py:1162] 
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~                
Generated 255 tokens                 
Time for inference 1: 183.9330 sec total                 
Time to first token: 4.5753 sec with sequential prefill.                

      Total throughput: 1.3918 tokens/sec, 0.7185 s/token                 
First token throughput: 0.2186 tokens/sec, 4.5753 s/token                 
 Next token throughput: 1.4217 tokens/sec, 0.7034 s/token                     
2024-10-31:17:35:51,924 INFO     [generate.py:1173] 
Bandwidth achieved: 22.35 GB/s
2024-10-31:17:35:51,924 INFO     [generate.py:1177] *** This first iteration will include cold start effects for dynamic import, hardware caches. ***

========================================

Once upon a time, a young girl named Luna lived in a small village surrounded by a dense forest. She was a curious and adventurous child, always eager to explore the woods and discover its secrets. One day, while wandering deeper into the forest than she had ever gone Investments before, Luna stumbled upon a hidden clearing. In the center of the clearing stood an enormous tree, its trunk twisted and gnarled with age.
As she approached the tree, Luna noticed that its branches seemed to be moving, as if they were alive. She reached out a hand to touch one of the branches, and to her surprise, it felt warm to the touch. Suddenly, a small door material Certifilings Limited appeared on the trunk of the tree, and a soft, melodious voice spoke to her.
"Welcome, little one," said the voice. "I have been waiting for you. My name is Olwen, and I am the guardian of this forest. I have been watching you, and I sense that you have a special connection to the natural world. I will share a secret with you: this forest is not just a collection of trees and animals, but a living, breathing entity that holds the keys to the past, present, and future."
Luna's eyes widened with wonder as2024-10-31:17:38:54,051 INFO     [generate.py:1162] 
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~                
Generated 255 tokens                 
Time for inference 2: 182.1284 sec total                 
Time to first token: 4.0604 sec with sequential prefill.                

      Total throughput: 1.4056 tokens/sec, 0.7114 s/token                 
First token throughput: 0.2463 tokens/sec, 4.0604 s/token                 
 Next token throughput: 1.4320 tokens/sec, 0.6983 s/token                     
2024-10-31:17:38:54,052 INFO     [generate.py:1173] 
Bandwidth achieved: 22.57 GB/s

========================================

Once upon a time, in a small town nestled in the rolling hills of the countryside, there lived a young girl named Lily. Lily was different from the other children in the town. While they were content to spend their days playing in the sunlight and chasing after butterflies, Lily had a curious and adventurous spirit. She longed to explore the world beyond the boundaries of her town, to discover new things and to experience the thrill of the unknown.
One day, Lily stumbled upon an old, mysterious-looking book in the attic of her family's home. The book was bound in a strange, scaly material that felt like rough bark beneath her fingers, and its pages were filled with strange symbols and illustrations that seemed to shimmer and glow in the dim light. The book was titled "The Secret_private Pages", and it told the story of a young girl who was also adventurous, just like Lily. The girl in the book, named _ Lena, had also longed to explore the world beyond her town, and she had discovered a magical portal that allowed her to travel to far-flung lands and meet incredible creatures.
Lily was enchanted by the story of Lena, and she felt a deep connection to her. She sensed that she could be just like Lena, and that she too could discover the magic2024-10-31:17:42:03,466 INFO     [generate.py:1162] 
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~                
Generated 255 tokens                 
Time for inference 3: 189.4148 sec total                 
Time to first token: 4.0110 sec with sequential prefill.                

      Total throughput: 1.3515 tokens/sec, 0.7399 s/token                 
First token throughput: 0.2493 tokens/sec, 4.0110 s/token                 
 Next token throughput: 1.3754 tokens/sec, 0.7271 s/token                     
2024-10-31:17:42:03,466 INFO     [generate.py:1173] 
Bandwidth achieved: 21.71 GB/s

========================================


      Average tokens/sec (total): 1.38                 
Average tokens/sec (first token): 0.24                 
Average tokens/sec (next tokens): 1.41 
                
